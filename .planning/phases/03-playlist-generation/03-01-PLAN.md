# Phase 3 Plan 03-01: Playlist Generation Foundations

## Goal
Stand up the core clustering + ordering pipeline for playlist suggestions using existing similarity scoring.

## Scope
- Build a single-path generator that:
  - filters track set by selected folders
  - computes similarity pairs (cached)
  - groups tracks into clusters with conservative thresholds
  - orders tracks within each cluster for smooth flow
- Add confidence scoring per cluster
- Provide clear telemetry for matches computed vs cache hits

## Inputs
- Tracks: filtered by folder selection
- Similarity scores: `computeBaselineSimilarity` + cached `track_similarity`
- Thresholds:
  - `similarityThreshold` (default 0.82)
  - `minClusterSize` (default 3)
  - `maxClusters` (default 24)

## Outputs
- `PlaylistSuggestion[]` with:
  - `id`, `name`, `trackIds`, `score`, `avgScore`, `minScore`, `maxScore`
  - `reasons` (aggregate BPM/key/waveform/rhythm summaries)
  - `stats` (pairCount, cacheHits, computed)

## Tasks
1. Audit `src/services/playlistClusterService.js` and align output to Phase 3 schema.
2. Add deterministic ordering strategy:
   - Sort by BPM, then key adjacency, then similarity score.
3. Add confidence scoring:
   - Base on average similarity, variance, and cluster size.
4. Update renderer to display suggested playlists (basic list).

## Success Criteria
- Generates multiple clusters from a 1k+ track sample set.
- Each cluster has deterministic order and confidence score.
- No UI freeze; uses existing caching and batching.

## Notes
- Conservative thresholds to avoid false positives.
- Later work (03-02+) will add flow optimization + UI polish.
